# ğŸš€ AvaliaÃ§Ã£o de desempenho de consultas analÃ­ticas

![Python Version](https://img.shields.io/badge/python-3.11+-blue.svg?logo=python)
![Database](https://img.shields.io/badge/Databases-DuckDB%20%7C%20MongoDB-green.svg)
![Status](https://img.shields.io/badge/Status-ConcluÃ­do-brightgreen.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

---

## ğŸ¯ Objetivo do Projeto
Este projeto realiza uma anÃ¡lise comparativa de desempenho (benchmark) entre duas arquiteturas distintas de banco de dados: um banco analÃ­tico embarcado (DuckDB) e um banco NoSQL distribuÃ­do em nuvem (MongoDB).

O objetivo principal nÃ£o Ã© determinar qual tecnologia Ã© superior, mas sim quantificar e analisar, de forma prÃ¡tica, como diferentes arquiteturas de dados se comportam ao executar cargas de trabalho analÃ­ticas intensivas (OLAP â€“ Online Analytical Processing), considerando mÃ©tricas como latÃªncia, estabilidade e variabilidade de execuÃ§Ã£o.

A anÃ¡lise busca responder Ã  seguinte questÃ£o:
Quais sÃ£o os trade-offs de desempenho observados ao executar consultas analÃ­ticas complexas â€” envolvendo agregaÃ§Ãµes e junÃ§Ãµes de grande volume de dados â€” em arquiteturas originalmente projetadas para propÃ³sitos distintos?

---

## ğŸ“ˆ Resultados de Impacto
### âš¡ Comparativo de LatÃªncia e Speedup
O grÃ¡fico abaixo demonstra a estabilidade da performance ao longo de 10 rodadas. O DuckDB opera na casa dos **milissegundos**, enquanto o MongoDB paga o "pedÃ¡gio" da latÃªncia de rede.

![Estabilidade e LatÃªncia](./img/estabilidade_performace_lineplot.png)
*Figura 1: Comparativo de tempo de execuÃ§Ã£o por rodada (Escala LogarÃ­tmica).*

### ğŸ“Š Tabela Resumo EstatÃ­stico
Hard data extraÃ­do das 10 rodadas de teste. Note a diferenÃ§a brutal nas medianas.

| Banco | Query | Mediana (s) | Desvio PadrÃ£o | Coef. VariaÃ§Ã£o | Outliers |
| :--- | :--- | :---: | :---: | :---: | :---: |
| **DuckDB (Local)** | Analise_Temporal | **0.0135** | 0.0012 | 8.68% | 2 |
| **DuckDB (Local)** | Ranking_Clientes_RFV | **0.0216** | 0.0016 | 7.08% | 1 |
| **MongoDB (Nuvem)** | Analise_Temporal | **0.6988** | 0.0875 | 12.09% | 1 |
| **MongoDB (Nuvem)** | Ranking_Clientes_RFV | **5.7483** | 0.1268 | 2.20% | 0 |

---
## ğŸ§  DiscussÃ£o TÃ©cnica & Insights
Os resultados refletem as decisÃµes arquiteturais de cada motor:

1.  **EficiÃªncia Colunar (DuckDB):** Por processar dados em colunas e rodar *in-process*, o DuckDB elimina o I/O desnecessÃ¡rio e a latÃªncia de rede, sendo ideal para *Time-to-Insight* rÃ¡pido.
2.  **Trade-offs do MongoDB:** O MongoDB prioriza escalabilidade e flexibilidade (OLTP). No cenÃ¡rio analÃ­tico, o custo do framework de agregaÃ§Ã£o (`$lookup`) e a latÃªncia da nuvem tornam as consultas ordens de magnitude mais lentas.
3.  **Variabilidade:** O grÃ¡fico de Boxplot abaixo mostra que o DuckDB possui uma dispersÃ£o mÃ­nima, enquanto o MongoDB sofre com a instabilidade inerente de ambientes distribuÃ­dos.

![DistribuiÃ§Ã£o de Performance](./img/variabilidde_outliers_boxplot.png)
*Figura 2: AnÃ¡lise de variabilidade e detecÃ§Ã£o de pontos fora da curva (Outliers).*

---

## ğŸ§­ Escopo e Metodologia

### ğŸ”¹ Escopo
- **Workload:** Consultas analÃ­ticas envolvendo agregaÃ§Ãµes massivas e junÃ§Ãµes (Joins/Lookups).
- **Dataset:** ~50k registros gerados via `Faker` (UsuÃ¡rios, Produtos, Vendas).
- **MÃ©tricas:** LatÃªncia, Desvio PadrÃ£o e Coeficiente de VariaÃ§Ã£o (CV%).

### âš ï¸ LimitaÃ§Ãµes
- O MongoDB foi testado no tier gratuito (M0) em nuvem, o que introduz latÃªncia de rede.
- O modelo de dados Ã© relacional, desafiando a natureza documental do MongoDB.

---
---
## ğŸ§  DiscussÃ£o TÃ©cnica (Insights)

Os resultados observados refletem diretamente as escolhas arquiteturais de cada tecnologia.

O DuckDB, por ser um banco analÃ­tico colunar e executado em-processo, apresentou tempos de resposta significativamente menores e maior previsibilidade em consultas OLAP, beneficiando-se da ausÃªncia de latÃªncia de rede e da otimizaÃ§Ã£o para agregaÃ§Ãµes em larga escala.

O MongoDB, por outro lado, mesmo apresentando tempos superiores, demonstrou estabilidade em algumas consultas especÃ­ficas. Esse comportamento estÃ¡ associado Ã  sua arquitetura distribuÃ­da e orientada a documentos, que prioriza flexibilidade de esquema, escalabilidade e workloads transacionais (OLTP), nÃ£o sendo otimizado nativamente para junÃ§Ãµes complexas e consultas analÃ­ticas pesadas.

Dessa forma, o benchmark nÃ£o indica um â€œvencedorâ€, mas evidencia como o uso de uma tecnologia fora de seu domÃ­nio principal implica trade-offs claros de desempenho e previsibilidade.

![DistribuiÃ§Ã£o de Performance](./img/variabilidde_outliers_boxplot.png)
*Figura 2: AnÃ¡lise de variabilidade e detecÃ§Ã£o de outliers entre as rodadas.*

---

### AnÃ¡lise de Resultados

O grÃ¡fico de linha abaixo demonstra a estabilidade da performance ao longo das 10 rodadas de teste.

![Estabilidade e LatÃªncia](img/estabilidade_performace_lineplot.png)

* **DuckDB:** Apresenta uma linha praticamente plana na base do grÃ¡fico, evidenciando a ausÃªncia de latÃªncia de rede e alta previsibilidade do motor local.
* **MongoDB:** Revela o "piso de latÃªncia" (network floor) em nuvem. Mesmo na consulta mais simples, o tempo nunca desce abaixo de ~0.6s devido ao tempo de ida e volta (Round Trip Time) da internet.



---

## ğŸ› ï¸ Tecnologias Utilizadas

- **Linguagem:** Python 3.11+
- **Bancos de Dados:**
    - ğŸ¦† **DuckDB:** Como representante de um banco de dados analÃ­tico, colunar e em-processo (in-process).
    - ğŸƒ **MongoDB:** Utilizando o serviÃ§o em nuvem **MongoDB Atlas** (Cluster M0 gratuito) como representante de um banco de dados NoSQL, orientado a documentos e distribuÃ­do.
- **Bibliotecas Principais:**
    - `pandas`: Para manipulaÃ§Ã£o e estruturaÃ§Ã£o dos dados.
    - `faker`: Para geraÃ§Ã£o de dados fictÃ­cios (mock data) de um e-commerce.
    - `pymongo`: Driver oficial para o MongoDB.
    - `sqlalchemy` & `duckdb-engine`: Para facilitar a inserÃ§Ã£o de dados no DuckDB.
    - `python-dotenv`: Para gerenciamento seguro de variÃ¡veis de ambiente.

---

## ğŸ“‚ Estrutura do Projeto

```
My_benchmark_duckDB_vs_mongoDB
â”œâ”€ analise.ipynb
â”œâ”€ create_data.py
â”œâ”€ dados_analise_duck.py
â”œâ”€ dados_analise_mongo.py
â”œâ”€ data
â”‚  â”œâ”€ data_produtos.csv
â”‚  â”œâ”€ data_usuarios.csv
â”‚  â””â”€ data_vendas.csv
â”œâ”€ duck
â”‚  â”œâ”€ duck_query.py
â”‚  â”œâ”€ mock_duckdb.py
â”‚  â””â”€ __init__.py
â”œâ”€ gerar_dados.py
â”œâ”€ mongo
â”‚  â”œâ”€ mock_mongodb.py
â”‚  â””â”€ querys_mongodb.py
â”œâ”€ README.MD
â”œâ”€ requirements.txt
â””â”€ timer
   â”œâ”€ timer.py
   â””â”€ __init__.py

```
---

## ğŸš€ Como Executar
### 1.Setup: pip install -r requirements.txt
### 2.Ambiente: Configure o .env com sua MONGO_CONN_STRING.
### 3. Pipeline:
```bash
    python popular_tudo_ecommerce.py         # 1. Popula os bancos
    python -m benchmark.OLAP.analise_duckdb  # 2. Benchmark DuckDB
    python -m benchmark.OLAP.analise_mongo
```

## ğŸš€ Guia de InstalaÃ§Ã£o e ExecuÃ§Ã£o

Siga os passos abaixo para configurar e executar o projeto em sua mÃ¡quina local.

### 1. PrÃ©-requisitos
* [Git](https://git-scm.com/)
* [Python 3.11+](https://www.python.org/)
* Uma conta no [MongoDB Atlas](https://www.mongodb.com/cloud/atlas) com um cluster M0 gratuito.

### 2. ConfiguraÃ§Ã£o do Ambiente

1.  **Clone o repositÃ³rio:**
    ```bash
    git clone [https://github.com/seu-usuario/My_benchmark_duckDB_vs_mongoDB.git](https://github.com/seu-usuario/My_benchmark_duckDB_vs_mongoDB.git)
    cd My_benchmark_duckDB_vs_mongoDB
    ```

2.  **Crie e ative um ambiente virtual:**
    ```bash
    # Cria o ambiente
    python -m venv venv

    # Ativa no Windows
    .\venv\Scripts\activate

    # Ativa no macOS/Linux
    source venv/bin/activate
    ```

3.  **Instale as dependÃªncias:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Configure as VariÃ¡veis de Ambiente (Passo Crucial):**
    * Crie um arquivo chamado `.env` na raiz do projeto.
    * Dentro deste arquivo, adicione sua **String de ConexÃ£o** do MongoDB Atlas.
    * **Importante:** No painel do MongoDB Atlas, vÃ¡ em `Network Access` e libere o acesso para o seu endereÃ§o de IP atual (`Add Current IP Address`).

    **Arquivo `.env`:**
    ```env
    MONGO_CONN_STRING="mongodb+srv://seu_usuario:sua_senha@seu_cluster.mongodb.net/"
    ```

### 3. ExecuÃ§Ã£o do Projeto

O projeto Ã© executado em duas fases:

#### Fase 1: GeraÃ§Ã£o e PopulaÃ§Ã£o dos Dados

Este script irÃ¡ gerar todos os dados fictÃ­cios (usuÃ¡rios, produtos e vendas) e carregÃ¡-los tanto no DuckDB quanto no MongoDB.

```bash
    python popular_tudo_ecommerce.py
```

#### Fase 2: ExecuÃ§Ã£o dos Benchmarks de AnÃ¡lise

ApÃ³s a populaÃ§Ã£o, execute os scripts de anÃ¡lise para cada banco de dados. Eles rodarÃ£o uma sÃ©rie de queries OLAP complexas e imprimirÃ£o os resultados e o tempo de execuÃ§Ã£o.

Executar o benchmark do DuckDB:
```
    python -m benchmark.OLAP.analise_duckdb
```

Executar o benchmark do MongoDB:
```
    python -m benchmark.OLAP.analise_mongo
```

ğŸ“ˆ Resultados Esperados e AnÃ¡lise

O benchmark confirma a especializaÃ§Ã£o de cada tecnologia. As consultas, embora idÃªnticas em seu objetivo de negÃ³cio, demonstram uma diferenÃ§a significativa de performance:

O DuckDB consistentemente supera o MongoDB em ordens de magnitude em todas as tarefas analÃ­ticas (OLAP).



ğŸ¤ ContribuiÃ§Ãµes

ContribuiÃ§Ãµes sÃ£o muito bem-vindas!
Sinta-se Ã  vontade para abrir issues com sugestÃµes ou enviar pull requests com melhorias.

ğŸ’¡ Autor
Desenvolvido por Carlos Franch


Projeto voltado para estudo e comparaÃ§Ã£o de desempenho entre sistemas de bancos de dados modernos.
